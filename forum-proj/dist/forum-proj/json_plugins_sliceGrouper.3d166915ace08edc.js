"use strict";(self.webpackChunkforum_proj=self.webpackChunkforum_proj||[]).push([[48],{3354:(I,v,l)=>{l.d(v,{SliceGrouper:()=>c});var f=l(5854),p=l(314),d=l(8271),h=l(9660);class c extends d.JH{constructor(){super(...arguments),Object.defineProperty(this,"zoomOutButton",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}_afterNew(){super._afterNew(),this._setRawDefault("threshold",5),this._setRawDefault("groupName","Other"),this._setRawDefault("clickBehavior","none"),this.initZoomButton(),this._root.addDisposer(this)}initZoomButton(){"none"!==this.get("clickBehavior")&&(this.zoomOutButton=this.root.tooltipContainer.children.push(f.z.new(this._root,{themeTags:["zoom"],icon:p.T.new(this._root,{themeTags:["button","icon"]})})),this.zoomOutButton.hide(),this.zoomOutButton.events.on("click",()=>{this.zoomOut()}))}handleData(){const e=this.get("series");if(e){let t=this.getPrivate("groupDataItem");if(!t){const i=this.get("legend"),g=e.get("categoryField","category"),n=e.get("valueField","value"),m={};m[g]=this.get("groupName",""),m[n]=0,e.data.push(m),t=e.dataItems[e.dataItems.length-1],t.get("slice").events.on("click",()=>{this.handleClick()}),this.setPrivate("groupDataItem",t),i&&(i.data.push(t),t.on("visible",D=>{D&&this.zoomOut()}))}const s=this.get("threshold",0),o=this.get("limit",1e3),a=[],r=[];let u=0;(s||o)&&(h.S6(e.dataItems,(i,g)=>{const n=i.get("legendDataItem");(i.get("valuePercentTotal")<=s||g>o-1)&&t!==i?(u+=i.get("value",0),r.push(i),i.hide(0),n&&n.get("itemContainer").hide(0)):(a.push(i),n&&n.get("itemContainer").show(0))}),this.setPrivate("normalDataItems",a),this.setPrivate("smallDataItems",r),this.updateGroupDataItem(u))}}zoomOut(){const e=this.getPrivate("groupDataItem");if(e&&e.show(),"zoom"==this.get("clickBehavior")){const o=this.getPrivate("normalDataItems",[]);h.S6(o,(a,r)=>{a.show()})}const s=this.getPrivate("smallDataItems",[]);h.S6(s,(o,a)=>{o.hide()}),this.zoomOutButton&&this.zoomOutButton.hide()}updateGroupDataItem(e){const t=this.get("series");if(t){const s={},o=t.get("categoryField","category"),a=t.get("valueField","value");s[o]=this.get("groupName",""),s[a]=e,t.data.setIndex(t.data.length-1,s);const r=this.getPrivate("groupDataItem");0==e?r.hide(0):r.isHidden()&&r.show(),"none"!=this.get("clickBehavior")&&r.get("slice").set("toggleKey","none")}}handleClick(){const e=this.get("clickBehavior"),t=this.getPrivate("smallDataItems");if("none"==e||t&&0==t.length)return;const s=this.get("series");this.getPrivate("groupDataItem").hide(),h.S6(s.dataItems,a=>{-1!==t.indexOf(a)?a.show():"zoom"==e&&a.hide()}),this.zoomOutButton.show()}_beforeChanged(){if(super._beforeChanged(),this.isDirty("series")){const e=this.get("series");e&&e.events.on("datavalidated",t=>{this.handleData()})}}}Object.defineProperty(c,"className",{enumerable:!0,configurable:!0,writable:!0,value:"SliceGrouper"}),Object.defineProperty(c,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:d.JH.classNames.concat([c.className])})}}]);